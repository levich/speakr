# Решение проблем

Когда что-то идет не так с Speakr, это руководство поможет вам быстро определить и решить распространенные проблемы. Большинство проблем попадают в несколько категорий — [проблемы с установкой](getting-started/installation.md), сбои транскрибации, проблемы с производительностью или особенности конкретных функций. Также проверьте [FAQ](faq.md) для общих вопросов. Понимание, где искать и что проверять, экономит часы разочарований.

## Проблемы с установкой и настройкой

### Контейнер не запускается

Когда ваш контейнер Docker отказывается запускаться или сразу завершается, проблема обычно заключается в вашей конфигурации. Сначала проверьте ваш [файл окружения](getting-started.md#step-3-configure-your-transcription-service) — одна опечатка в API-ключах или несоответствующие кавычки могут предотвратить запуск. Просмотрите [руководство по установке](getting-started/installation.md) для правильной настройки. Запустите `docker compose logs app`, чтобы увидеть фактические сообщения об ошибках. Распространенные причины включают конфликты портов (другой сервис использует 8899), отсутствующие монтирования томов или неправильные права доступа к файлам в вашей директории данных.

Если вы видите ошибки подключения к базе данных, убедитесь, что ваш файл базы данных имеет правильные права доступа. Контейнер запускается от имени конкретного пользователя и нуждается в доступе на чтение/запись к директориям данных. В системах Linux вам может потребоваться настроить владельца с помощью `chown -R 1000:1000 ./uploads ./instance`.

### Не могу получить доступ к веб-интерфейсу

Когда Speakr успешно запускается, но вы не можете получить доступ к веб-интерфейсу, проблема обычно в сетевой конфигурации. Сначала убедитесь, что контейнер действительно запущен с помощью `docker ps`. Проверьте, что порт 8899 правильно сопоставлен — файл docker-compose должен показывать `"8899:8899"` в разделе портов.

Правила файрвола часто блокируют доступ, особенно на облачных серверах. Убедитесь, что порт 8899 открыт в вашем файрволе, группах безопасности (AWS) или сетевых политиках. Если вы обращаетесь с другой машины, помните, что `localhost` не будет работать — используйте фактический IP-адрес сервера или имя хоста.

### Не удается войти как администратор

Если вы не можете войти с вашими [учетными данными администратора](getting-started.md#step-4-configure-admin-account), сначала убедитесь, что вы используете точное имя пользователя и пароль из вашего файла окружения. Для проблем с управлением пользователями см. [руководство администратора](admin-guide/user-management.md). Они чувствительны к регистру и должны точно совпадать. Проверьте логи Docker на сообщения о создании пользователя-администратора — вы должны увидеть "Admin user created successfully" при первом запуске.

Иногда создание пользователя-администратора молча завершается неудачей, если пароль не соответствует требованиям. Убедитесь, что ваш пароль администратора имеет длину не менее 8 символов. Если пользователь-администратор не был создан, вам может потребоваться удалить файл базы данных и перезапустить контейнер, чтобы снова запустить инициализацию.

## Проблемы с транскрибацией

### Транскрибация никогда не начинается

Когда записи остаются в статусе "pending" бесконечно, фоновый процессор мог остановиться. Проверьте логи на сообщения об ошибках о [сервисе транскрибации](features.md#multi-engine-support). Мониторьте статус обработки в панели администратора [векторного хранилища](admin-guide/vector-store.md). Проблемы с API-ключами — наиболее распространенная причина — убедитесь, что ваш API-ключ OpenAI или OpenRouter действителен и имеет доступные кредиты.

Проблемы с сетевым подключением также могут предотвращать транскрибацию. Контейнеру нужно достичь внешних API-эндпоинтов. Если вы за корпоративным прокси, вам нужно настроить параметры прокси в вашем окружении Docker.

### Транскрибация сразу завершается неудачей

Быстрые сбои обычно указывают на проблемы с аутентификацией API. Дважды проверьте ваши API-ключи в файле окружения. Помните, что OpenAI и OpenRouter используют разные форматы ключей. Ключи OpenAI начинаются с "sk-", в то время как ключи OpenRouter выглядят иначе. Убедитесь, что вы используете правильный ключ для вашего настроенного сервиса.

Лимиты скорости API или недостаточные кредиты также вызывают немедленные сбои. Войдите в панель управления вашего провайдера API, чтобы проверить ваше использование и лимиты. Некоторые планы API имеют ограничительные лимиты скорости, которые Speakr может превысить с большими файлами.

### ASR-эндпоинт возвращает ошибки 405 или 404

Если вы получаете ошибки "405 Method Not Allowed" или "404 Not Found" с Whisper ASR-веб-сервисом, проверьте вашу конфигурацию ASR_BASE_URL. URL не должен включать завершающие комментарии или описания — удалите все после символа # в вашем файле окружения. Для Whisper ASR-веб-сервиса используйте только базовый URL, например `http://whisper-asr:9000`, без `/asr` в конце.

При использовании Docker Compose всегда используйте имена контейнеров, а не IP-адреса для связи между сервисами. Вместо `http://192.168.1.132:9000` используйте `http://whisper-asr-webservice:9000`, где `whisper-asr-webservice` — это имя вашего контейнера.

### Плохое качество транскрибации

Точность транскрибации сильно зависит от качества аудио. Фоновый шум, несколько перекрывающихся говорящих или плохое размещение микрофона — все это ухудшает результаты. Модели ИИ работают лучше всего с четким одноголосым аудио или хорошо разделенными несколькими говорящими.

Несоответствия языков также вызывают плохие результаты. Если вы установили конкретный язык транскрибации в настройках, но загружаете аудио на другом языке, точность страдает. Либо установите правильный язык, либо оставьте пустым для автоматического определения.

Для записей с несколькими говорящими использование [ASR-эндпоинта с идентификацией говорящих](features.md#speaker-diarization) значительно улучшает пригодность. Узнайте, как [идентифицировать говорящих](user-guide/transcripts.md#speaker-identification) после транскрибации, даже если исходная точность транскрибации аналогична.

### Проблемы с китайской транскрибацией

Для [китайской транскрибации](features.md#language-support) выбор модели критичен. См. [FAQ о поддержке языков](faq.md#can-speakr-transcribe-languages-other-than-english) для получения более подробной информации.

**Важно**: Дистиллированные модели (такие как distil-large-v3) не поддерживают китайскую транскрибацию должным образом. Даже когда вы устанавливаете язык на "zh", эти модели могут распознавать китайское аудио как английское и производить неправильный вывод. Всегда используйте полную модель large-v3 или аналогичные недистиллированные модели для китайского контента. Если вы получаете английскую транскрибацию для китайского аудио или романизированный вывод вместо китайских символов, переключитесь с дистиллированной модели на large-v3.

### Язык сводки не соответствует предпочтениям

Если [сводки](features.md#automatic-summarization) возвращаются к английскому, когда вы нажимаете "Reprocess Summary", несмотря на установленные [языковые предпочтения](user-guide/settings.md#language-preferences), это может быть ограничением модели. Настройте [пользовательские промпты](admin-guide/prompts.md), чтобы принудительно применять языковые требования. Некоторые модели, такие как Qwen3-30B, не всегда правильно следуют языковым инструкциям. Попробуйте использовать другую модель, которая лучше уважает языковые директивы, или убедитесь, что ваш пользовательский промпт явно указывает язык вывода.

## Проблемы с производительностью

### Медленная обработка транскрибации

Большие аудиофайлы естественно занимают больше времени для обработки, но чрезмерные задержки указывают на проблемы. Проверьте ваши [ресурсы сервера](getting-started.md#prerequisites) и просмотрите [системную статистику](admin-guide/statistics.md) для метрик производительности — Speakr нуждается в достаточном CPU и RAM, особенно при обработке нескольких записей одновременно. Команда `docker stats` показывает текущее использование ресурсов.

Скорость сети влияет на время транскрибации, поскольку аудио должно загружаться в API-сервисы. Медленные интернет-соединения создают узкие места, особенно для больших файлов. Рассмотрите настройки разделения, если вы постоянно работаете с длинными записями.

Выбор модели транскрибации влияет на скорость. Whisper Large более точен, но медленнее, чем Whisper Base. Если скорость важнее идеальной точности, рассмотрите использование меньшей модели через ваши настройки API.

### Файлы более 25 МБ завершаются неудачей с OpenAI

API Whisper от OpenAI имеет лимит размера файла 25 МБ. Для больших файлов включите [разделение](features.md#audio-chunking) в вашей конфигурации окружения. Узнайте о [стратегиях разделения](faq.md#whats-the-difference-between-chunking-by-size-vs-duration):

```
ENABLE_CHUNKING=true
CHUNK_LIMIT=20MB  # или используйте длительность: CHUNK_LIMIT=1400s
CHUNK_OVERLAP_SECONDS=3
```

Вы можете указать лимиты частей либо по размеру файла (МБ), либо по длительности (секунды). Для моделей с конкретными временными лимитами, такими как максимум 1500 секунд Azure, используйте разделение на основе длительности. Система автоматически разделит ваши записи и соберет транскрипцию обратно.

### Таймаут ASR на длинных записях

Длинные записи (более 30 минут) могут таймаутиться во время обработки ASR. Увеличьте таймаут в Настройки администратора > Системные настройки > "ASR Timeout Seconds". Для 2-часовой записи установите его как минимум на 7200 секунд (2 часа). Очень длинные записи, такие как файлы 3+ часа, могут потребовать более длительных таймаутов в зависимости от GPU, который вы используете для транскрибации (если локально).

### Веб-интерфейс кажется медленным

Производительность браузера ухудшается с очень большими транскрипциями. Записи более 2 часов могут генерировать огромные объемы текста, с отображением которых некоторые браузеры могут с трудом справляться плавно. Пузырьковый вид для транскрипций с метками говорящих особенно ресурсоемок.

Очистите кеш браузера, если интерфейс постепенно становится медленнее со временем. Speakr кеширует данные локально для производительности, но этот кеш может стать поврежденным. В Chrome или Firefox выполните жесткое обновление с помощью Ctrl+Shift+R, чтобы перезагрузить свежие ресурсы.

## Проблемы с конкретными функциями

### Идентификация говорящих не работает

[Идентификация говорящих](features.md#speaker-diarization) требует [ASR-эндпоинта](getting-started.md#option-b-custom-asr-endpoint-configuration), а не стандартного API Whisper. Настройте параметры говорящих в [системных настройках](admin-guide/system-settings.md). Убедитесь, что вы правильно настроили параметры ASR в вашем файле окружения. ASR_BASE_URL должен указывать на действительный ASR-сервис, который поддерживает идентификацию говорящих.

Даже при включенном ASR вы должны явно запросить идентификацию говорящих при загрузке или повторной обработке записей. Speakr должен делать это по умолчанию, но пользовательские настройки могут переопределить это поведение. Проверьте настройки количества говорящих — если вы установите минимальное и максимальное количество говорящих на 1, идентификация говорящих эффективно отключается. Используйте разумные диапазоны, такие как 2-6 говорящих для большинства записей.

После транскрибации говорящие появляются как общие метки (SPEAKER_01 и т.д.). Вы должны вручную [идентифицировать говорящих](user-guide/transcripts.md#speaker-identification), нажимая на метки и назначая имена. Управляйте вашей [библиотекой говорящих](user-guide/settings.md#speakers-management-tab) в настройках аккаунта.

### WhisperX показывает UNKNOWN_SPEAKER

Если WhisperX показывает только "UNKNOWN_SPEAKER" вместо пронумерованных говорящих (SPEAKER_00, SPEAKER_01 и т.д.), проверьте эти распространенные проблемы:

1. **Неправильный ASR_ENGINE**: Вы должны использовать `ASR_ENGINE=whisperx` в окружении Docker вашего ASR-контейнера. Движок `faster_whisper` НЕ поддерживает идентификацию говорящих, хотя он может транскрибировать аудио.

2. **Отсутствующий или недействительный HF_TOKEN**: ASR-контейнеру нужен действительный токен HuggingFace для загрузки моделей идентификации говорящих. Убедитесь, что ваша переменная окружения `HF_TOKEN` установлена в конфигурации ASR-контейнера.

3. **ASR_DIARIZE не включен**: Хотя это должно быть автоматическим, когда `USE_ASR_ENDPOINT=true`, явно установите `ASR_DIARIZE=true` в вашем файле .env Speakr, если говорящие не обнаруживаются.

4. **Проблемы с сетью Docker**: Если используете контейнеры Speakr и ASR-веб-сервиса в одном docker-compose, контейнеры должны общаться через имена сервисов (например, `http://whisper-asr:9000`), а не localhost или внешние IP.

Проверьте логи вашего ASR-контейнера на сообщения pyannote/VAD, чтобы подтвердить, что модели идентификации говорящих загружаются правильно.

### ASR-сервис на Mac показывает ошибки GPU

Если вы запускаете ASR-веб-сервис на macOS и получаете ошибки, связанные с GPU, или ошибки "no matching manifest":

- **Используйте образ CPU**: Замените `onerahmet/openai-whisper-asr-webservice:latest-gpu` на `onerahmet/openai-whisper-asr-webservice:latest`
- **Удалите конфигурацию GPU**: Удалите весь раздел `deploy` с резервированием устройств GPU из вашего docker-compose.yml
- **Ожидайте более медленную обработку**: Транскрибация на основе CPU работает, но значительно медленнее, чем ускорение GPU

Это ограничение Docker на macOS — проброс GPU не поддерживается, потому что Docker запускается в виртуальной машине Linux. См. [FAQ](faq.md#can-i-use-the-asr-webservice-for-speaker-diarization-on-mac) для полной конфигурации Mac.

### Ссылки для обмена не работают

[Обмен](user-guide/sharing.md) требует, чтобы ваш экземпляр Speakr был доступен из интернета с HTTPS. См. [требования для обмена](user-guide/sharing.md#requirements-for-sharing) и [соображения безопасности](user-guide/sharing.md#security-and-privacy-considerations). Локальные установки или настройки без SSL не могут генерировать рабочие ссылки для обмена. Кнопка обмена будет отключена или покажет ошибку, объясняющую требования.

Если ваш экземпляр соответствует требованиям, но обмены все еще не работают, проверьте, что настроенный URL в окружении соответствует реальности. Несоответствующие URL вызывают, что ссылки для обмена указывают на неправильное местоположение. URL должен быть точно тем, что внешние пользователи будут использовать для доступа к вашему экземпляру.

### Режим Inquire не возвращает результатов

[Семантический поиск](user-guide/inquire-mode.md) требует, чтобы модель эмбеддингов была правильно установлена и инициализирована. Проверьте [вкладку Vector Store](admin-guide/vector-store.md) в настройках администратора и просмотрите [решение проблем с векторным хранилищем](admin-guide/vector-store.md#troubleshooting-common-issues) — она должна показывать статус "Available". Если нет, библиотека sentence-transformers может отсутствовать или не загрузиться.

Все записи нуждаются в обработке, прежде чем они станут доступными для поиска. Вкладка Vector Store показывает, сколько записей обработано по сравнению с ожидающими. Используйте кнопку обработки, чтобы вручную запустить генерацию эмбеддингов, если автоматическая обработка остановилась.

Формулировка запроса имеет огромное значение. [Режим Inquire](user-guide/inquire-mode.md) понимает контекст и значение, а не только ключевые слова. Узнайте [эффективные стратегии поиска](user-guide/inquire-mode.md#asking-effective-questions) в руководстве пользователя. Задавайте полные вопросы, а не просто вводите изолированные слова. "Что мы решили по поводу бюджета?" работает лучше, чем просто "решение бюджета".

## Дополнительные соображения

### Отказ от ответственности при записи для юридического соответствия

Во многих юрисдикциях вы должны информировать участников, что их записывают. Включите отказ от ответственности при записи в [Системных настройках](admin-guide/system-settings.md#recording-disclaimer). Проверьте [FAQ о соответствии при записи](faq.md#do-i-need-to-inform-people-theyre-being-recorded). Установите пользовательский текст, который появляется перед началом любой записи, такой как юридические уведомления о требованиях согласия. Эта функция особенно важна в регионах со строгими законами о записи, таких как Австралия или Калифорния.

### Офлайн-развертывание

Speakr может работать полностью офлайн, так как все зависимости встроены в образ Docker. Для офлайн-развертываний используйте локальные модели через Ollama для [генерации текста](features.md#automatic-summarization) и убедитесь, что ваш ASR-эндпоинт размещен локально. Система будет работать без доступа к интернету после правильной настройки.

### Установка без Docker

Хотя Docker — единственный официально поддерживаемый метод установки, вы можете попытаться выполнить ручную установку, используя npm и Python. Вам нужно будет самостоятельно обрабатывать зависимости, настройку окружения и конфигурацию. Этот подход не рекомендуется для регулярного использования, и вам нужно будет самостоятельно решать проблемы.

## Получение помощи

### Проверка логов

Логи Docker содержат ценную информацию для отладки. Используйте `docker compose logs -f app`, чтобы увидеть логи в реальном времени. Ищите сообщения ERROR или WARNING, которые соответствуют времени возникновения проблем. Трассировки Python указывают на проблемы на уровне кода, которые могут потребовать поддержки.

Для проблем с ASR также проверьте логи ASR-контейнера: `docker compose logs -f whisper-asr-webservice`

### Системная информация

При запросе помощи предоставьте конфигурацию вашей системы из вкладки About в настройках аккаунта. Включите версию Speakr, настроенную модель ИИ, тип сервиса транскрибации и любые сообщения об ошибках. Этот контекст помогает другим понять вашу конкретную настройку.

### Поддержка сообщества

Трекер проблем репозитория GitHub — ваш лучший ресурс для сообщения об ошибках или запроса функций. Сначала поищите существующие проблемы — кто-то мог уже столкнуться с вашей проблемой и решить её. При создании новых проблем включите конкретные шаги для воспроизведения проблемы.

---

Далее: [FAQ](faq.md) →
